<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src 'unsafe-inline'; script-src 'unsafe-inline'; img-src 'self' data: vscode-resource:; font-src 'self' vscode-resource:;">
    <title>Claude Code Permission</title>
    <style>
        @keyframes blink {

            0%,
            49% {
                opacity: 1;
            }

            50%,
            100% {
                opacity: 0;
            }
        }

        /* VS Code 테마 변수 */
        :root {
            /* VS Code에서 제공하는 CSS 변수 사용 */
            --vscode-editor-background: var(--vscode-editor-background);
            --vscode-editor-foreground: var(--vscode-editor-foreground);
            --vscode-button-background: var(--vscode-button-background);
            --vscode-button-foreground: var(--vscode-button-foreground);
            --vscode-button-hoverBackground: var(--vscode-button-hoverBackground);
            --vscode-button-secondaryBackground: var(--vscode-button-secondaryBackground);
            --vscode-button-secondaryForeground: var(--vscode-button-secondaryForeground);
            --vscode-input-background: var(--vscode-input-background);
            --vscode-input-border: var(--vscode-input-border);
            --vscode-focusBorder: var(--vscode-focusBorder);
            --vscode-badge-background: var(--vscode-badge-background);
            --vscode-badge-foreground: var(--vscode-badge-foreground);
            --vscode-errorForeground: var(--vscode-errorForeground);
            --vscode-warningForeground: var(--vscode-warningForeground);
            --vscode-successForeground: var(--vscode-successForeground);

            /* 사용자 정의 테마 색상 */
            --terminal-green: #00ff00;
            --terminal-yellow: #ffff00;
            --terminal-red: #ff0000;
        }

        /* 다크 테마 스타일 */
        body {
            margin: 0;
            padding: 20px;
            font-family: var(--vscode-font-family, 'Consolas', 'Monaco', 'Courier New', monospace);
            background: var(--vscode-editor-background);
            color: var(--vscode-editor-foreground);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .vscode-dark body {
            /* 다크 테마에서 터미널 스타일 유지 */
            --terminal-green: #00ff00;
            --terminal-yellow: #ffff00;
            --terminal-red: #ff6b6b;
            /* 부드러운 빨간색, 눈에 덜 부담스러움 */
        }

        .vscode-light body {
            /* 라이트 테마에서 색상 조정 - 가독성을 위해 어두운 색상 사용 */
            --terminal-green: #1565c0;
            /* Blue 800 - 녹색 대신 진한 파란색 */
            --terminal-yellow: #3e2723;
            /* Brown 900 - 매우 어두운 갈색 */
            --terminal-red: #8d4e41;
            /* 갈색이 섞인 빨간색 - 눈에 덜 부담스러움 */

            /* WARNING의 연한 노란색 배경 사용, 더 부드러움 */
            background: #fff3cd;
        }

        .container {
            background: var(--vscode-input-background);
            border: 2px solid var(--vscode-focusBorder);
            padding: 30px;
            max-width: 600px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        /* 라이트 테마에서의 컨테이너 배경 */
        .vscode-light .container {
            background: #fffef9;
            /* 더 연한 크림색, 페이지 배경과 조화 */
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.08);
        }


        .terminal-header {
            color: var(--terminal-green);
            margin-bottom: 10px;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* 라이트 테마에서 터미널 헤더는 어두운 색상 사용 */
        .vscode-light .terminal-header {
            color: #424242;
            /* 진한 회색 */
        }

        .terminal-title {
            display: flex;
            align-items: center;
            font-weight: bold;
        }

        /* 라이트 테마에서 제목은 어두운 색상 사용 */
        .vscode-light .terminal-title {
            color: #424242;
            /* 진한 회색 */
        }

        .terminal-title::before {
            content: '$ ';
            color: var(--terminal-yellow);
            margin-right: 5px;
        }

        /* 라이트 테마에서 달러 기호는 파란색 사용 */
        .vscode-light .terminal-title::before {
            color: #1565c0;
            /* 진한 파란색 */
        }

        .action-box {
            background: var(--vscode-input-background);
            border: 1px solid var(--vscode-input-border);
            padding: 15px 20px;
            margin: 5px 0 10px 0;
            position: relative;
        }

        /* 라이트 테마에서 action-box 투명 배경 */
        .vscode-light .action-box {
            background: transparent;
            border: none;
        }

        .action-box h3 {
            color: var(--terminal-green);
            margin: 0 0 15px 0;
            font-size: 18px;
            font-weight: normal;
            text-transform: uppercase;
        }

        .action-box h3::before {
            content: '[*] ';
            color: var(--terminal-yellow);
        }

        /* 라이트 테마에서 action-box 제목은 어두운 색상 사용 */
        .vscode-light .action-box h3 {
            color: #424242;
            /* 진한 회색 */
        }

        .action-box p {
            margin: 10px 0;
            font-size: 14px;
            color: var(--terminal-green);
        }

        /* 라이트 테마에서 action-box 텍스트는 어두운 색상 사용 */
        .vscode-light .action-box p {
            color: #424242;
            /* 진한 회색, 읽기 쉬움 */
        }

        .arrow-text {
            display: block;
            margin: 15px 0;
            font-size: 14px;
            color: var(--terminal-green);
            /* 대비도 향상을 위해 녹색 사용 */
        }

        /* 라이트 테마에서 arrow-text는 어두운 색상 사용 */
        .vscode-light .arrow-text {
            color: #616161;
            /* 중간 진한 회색 */
        }

        /* 라이트 테마에서 arrow-text 커서도 같은 색상 사용 */
        .vscode-light .arrow-text::after {
            color: #616161;
            /* 텍스트와 같은 중간 진한 회색 */
        }

        .arrow-text::after {
            content: '_';
            color: var(--terminal-green);
            /* 커서도 녹색으로 변경 */
            animation: blink 1s infinite;
        }

        .content {
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: var(--terminal-green);
        }

        .content p {
            margin: 10px 0;
        }

        .content strong {
            color: var(--terminal-yellow);
            background: var(--vscode-badge-background);
            padding: 2px 5px;
        }

        .image-container {
            position: relative;
            margin: 20px 0;
            padding: 10px;
            background: var(--vscode-input-background);
            border: 3px solid var(--terminal-red);
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.2);
            /* 그림자 약화 */
        }

        /* 라이트 테마에서 빨간 갈색 테두리 사용 */
        .vscode-light .image-container {
            border: 3px solid #a1665e;
            /* 빨간 갈색 */
            box-shadow: 0 0 20px rgba(161, 102, 94, 0.3);
        }

        .image-container::before {
            content: 'Permission Required';
            position: absolute;
            top: -15px;
            left: 20px;
            background: var(--vscode-editor-background);
            color: var(--terminal-red);
            padding: 0 10px;
            font-size: 14px;
            font-weight: bold;
            letter-spacing: 2px;
        }

        /* 라이트 테마에서 ATTENTION 라벨이 보이도록 */
        .vscode-light .image-container::before {
            background: white;
            border: 1px solid var(--terminal-red);
        }

        .terminal-content {
            font-family: var(--vscode-editor-font-family, 'SF Mono', Monaco, Consolas, 'Courier New', monospace);
            font-size: 12px;
            /* 터미널 내용 글꼴 크기 조정 */
            line-height: 1.5;
            padding: 15px;
            background: var(--vscode-terminal-background, var(--vscode-editor-background));
            color: var(--vscode-terminal-foreground, var(--vscode-editor-foreground));
            border-radius: 4px;
        }

        .warning-banner {
            color: var(--terminal-yellow);
            font-weight: bold;
            margin-bottom: 12px;
            text-align: center;
            letter-spacing: 1px;
            font-size: 13px;
            /* 제목 글꼴 크기 조정 */
        }

        /* 라이트 테마에서 경고 텍스트 배경 강화 */
        .vscode-light .warning-banner {
            color: #856404;
            /* 진한 갈색 텍스트 */
            background: #fff3cd;
            padding: 5px;
            border: 1px solid #ffeeba;
        }

        .warning-text {
            margin-bottom: 20px;
        }

        .warning-text p {
            margin: 8px 0;
            line-height: 1.5;
            font-size: 12px;
            /* 경고 텍스트 크기 조정 */
        }

        .warning-text .link {
            color: var(--vscode-textLink-foreground);
            text-decoration: underline;
        }

        .permission-options {
            margin-top: 12px;
            font-family: var(--vscode-editor-font-family, monospace);
            font-size: 12px;
            /* 옵션 글꼴 크기 조정 */
        }

        .permission-option {
            padding: 5px 10px;
            margin: 2px 0;
        }

        .permission-option.selected {
            background: var(--vscode-list-activeSelectionBackground);
            color: var(--vscode-list-activeSelectionForeground);
            font-weight: bold;
        }

        /* 라이트 테마 적응 */
        .vscode-light .terminal-content {
            background: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
        }

        .vscode-light .permission-option.selected {
            background: #007acc;
            color: white;
        }

        /* 라이트 테마에서 모든 노란색 텍스트가 읽기 쉽도록 */
        .vscode-light .action-box h3::before,
        .vscode-light .option::before,
        .vscode-light .option::after,
        .vscode-light .status-info::before {
            color: var(--terminal-yellow);
            font-weight: bold;
        }

        .vscode-light .content strong {
            background: #fff3cd;
            color: #856404;
            padding: 2px 5px;
            border-radius: 3px;
            border: 1px solid #ffeeba;
        }

        .options {
            margin-top: 30px;
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .option {
            padding: 12px 30px;
            cursor: pointer;
            transition: all 0.1s;
            font-size: 14px;
            font-weight: normal;
            border: 2px solid var(--vscode-button-background);
            text-align: center;
            min-width: 180px;
            background: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
            text-transform: uppercase;
            position: relative;
            font-family: var(--vscode-font-family, 'Consolas', 'Monaco', 'Courier New', monospace);
        }

        .option::before {
            content: '[ ';
            color: var(--terminal-yellow);
        }

        .option::after {
            content: ' ]';
            color: var(--terminal-yellow);
        }

        .option:hover {
            background: var(--vscode-button-hoverBackground);
            color: var(--vscode-button-foreground);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }

        .option.cancel {
            border-color: var(--vscode-button-secondaryBackground);
            background: var(--vscode-button-secondaryBackground);
            color: var(--vscode-button-secondaryForeground);
        }

        .option.cancel::before,
        .option.cancel::after {
            color: var(--vscode-button-secondaryForeground);
        }

        .option.cancel:hover {
            background: var(--vscode-button-secondaryHoverBackground, var(--vscode-button-secondaryBackground));
            color: var(--vscode-button-secondaryForeground);
            border-color: var(--vscode-button-secondaryBackground);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .option.accept {
            border-color: var(--terminal-green);
            background: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
            animation: pulse-border 2s infinite;
        }

        @keyframes pulse-border {

            0%,
            100% {
                box-shadow: 0 0 5px var(--vscode-focusBorder);
            }

            50% {
                box-shadow: 0 0 20px var(--vscode-focusBorder);
            }
        }

        .status-info {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid var(--vscode-input-border);
            background: var(--vscode-input-background);
            font-size: 12px;
            color: var(--vscode-editor-foreground);
            opacity: 0.8;
        }

        .status-info::before {
            content: '> ';
            color: var(--terminal-yellow);
        }

        .issue-link {
            color: var(--vscode-textLink-foreground);
            text-decoration: none;
            font-size: 12px;
            transition: all 0.1s;
        }

        /* 라이트 테마에서 issue 링크 색상 */
        .vscode-light .issue-link {
            color: #666666;
            /* 중간 회색 */
        }

        .issue-link:hover {
            color: var(--vscode-textLink-activeForeground);
            text-decoration: underline;
        }

        /* 터미널 스타일 유지 - 이미 :root에서 CSS 변수로 정의됨 */

        /* 고대비 테마 지원 */
        .vscode-high-contrast {
            --terminal-green: var(--vscode-terminal-ansiGreen);
            --terminal-yellow: var(--vscode-terminal-ansiYellow);
            --terminal-red: var(--vscode-terminal-ansiRed);
        }

        /* 비대화형 모드 안내 스타일 */
        .note-section {
            margin-top: 20px;
            padding: 20px;
            background: var(--vscode-editorInfo-background, var(--vscode-input-background));
            border: 1px solid var(--vscode-editorInfo-border, var(--vscode-input-border));
            border-radius: 4px;
            font-size: 15px;
            /* 글꼴 크기 증가 */
        }

        .note-title {
            color: var(--vscode-editorWarning-foreground, var(--terminal-yellow));
            font-weight: bold;
            margin: 0 0 10px 0;
            font-size: 16px;
            /* 제목 글꼴 크기 증가 */
        }

        .note-text {
            color: var(--vscode-editor-foreground);
            line-height: 1.6;
            margin: 0;
            font-size: 15px;
            /* 본문 글꼴 크기 증가 */
        }

        .note-text code {
            background: var(--vscode-textCodeBlock-background, rgba(0, 0, 0, 0.1));
            padding: 2px 4px;
            border-radius: 3px;
            font-family: var(--vscode-editor-font-family, monospace);
            font-size: 0.9em;
        }

        /* 라이트 테마에서의 코드 블록 스타일 */
        .vscode-light .note-text code {
            background: rgba(0, 0, 0, 0.06);
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="terminal-header">
            <div class="terminal-title">CLAUDE CODE PERMISSION SETUP v1.0</div>
            <a href="#" class="issue-link" onclick="openIssue(event)">[ ISSUE #3 ]</a>
        </div>


        <div class="action-box">
            <p>> KIRO FOR CC REQUIRES PERMISSION TO RUN COMMANDS</p>
            <p>> REVIEW THE SECURITY WARNING</p>
            <span class="arrow-text">> GRANT PERMISSION BELOW TO CONTINUE</span>

        </div>



        <div class="image-container">
            <div class="terminal-content">
                <div class="warning-banner">
                    WARNING: Claude Code running in Bypass Permissions mode
                </div>
                <div class="warning-text">
                    <p>In Bypass Permissions mode, Claude Code will not ask for your approval before running potentially
                        dangerous commands.</p>
                    <p>This mode should only be used in a sandboxed container/VM that has restricted internet access and
                        can easily be restored if damaged.</p>
                    <p>By proceeding, you accept all responsibility for actions taken while running in Bypass
                        Permissions mode.</p>
                    <p class="link">https://docs.anthropic.com/s/claude-code-security</p>
                </div>
                <div class="permission-options">
                    <div class="permission-option">1. No, exit</div>
                    <div class="permission-option selected">&gt; 2. Yes, I accept</div>
                </div>
            </div>
        </div>



        <!-- <div class="content">
            <span class="arrow-text">> All interactive commands will fail until permissions are granted.</span>
            <span class="arrow-text">> LOOK FOR PERMISSION REQUEST BELOW_</span>
            <span class="arrow-text">> LOOK FOR PERMISSION REQUEST BELOW_</span>
            <span class="arrow-text">> LOOK FOR PERMISSION REQUEST BELOW_</span>


            <div class="note-section">
                <p class="note-text">If using Claude Code interactive command, you must grant permissions
                    first.</p>
                <p class="note-text">All interactive commands will fail until permissions are granted.</p>
            </div>
        </div> -->

        <div class="options">
            <div class="option accept" onclick="handleAccept()">
                Grant Permission
            </div>
            <div class="option cancel" onclick="handleCancel()">
                Cancel
            </div>
        </div>
    </div>

    <script>
        const vscode = acquireVsCodeApi();

        // Input validation for commands
        function isValidCommand(command) {
            const validCommands = ['accept', 'cancel', 'openIssue'];
            return validCommands.includes(command);
        }

        function handleAccept() {
            vscode.postMessage({
                command: 'accept'
            });
        }

        function handleCancel() {
            vscode.postMessage({
                command: 'cancel'
            });
        }

        function openIssue(event) {
            event.preventDefault();
            vscode.postMessage({
                command: 'openIssue'
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                handleAccept();
            } else if (e.key === 'Escape') {
                handleCancel();
            }
        });

        // Handle status updates from extension with validation
        window.addEventListener('message', event => {
            const message = event.data;
            
            // Validate message structure
            if (!message || typeof message !== 'object' || !message.command) {
                return;
            }
            
            if (message.command === 'updateStatus') {
                const statusInfo = document.querySelector('.status-info');
                if (statusInfo && message.status) {
                    // Validate status values
                    const validStatuses = ['verifying', 'failed', 'success'];
                    if (!validStatuses.includes(message.status)) {
                        return;
                    }

                    // Sanitize message content by limiting length and escaping
                    let displayMessage = '';
                    
                    switch (message.status) {
                        case 'verifying':
                            displayMessage = 'STATUS: Verifying permissions...';
                            statusInfo.style.color = 'var(--terminal-yellow)';
                            break;
                        case 'failed':
                            // Limit message length and escape HTML
                            const failMessage = message.message ? 
                                String(message.message).substring(0, 200) : 
                                'Verification failed';
                            displayMessage = 'STATUS: ' + failMessage.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                            statusInfo.style.color = 'var(--terminal-red)';
                            break;
                        case 'success':
                            displayMessage = 'STATUS: Permission granted successfully!';
                            statusInfo.style.color = 'var(--terminal-green)';
                            break;
                    }
                    
                    statusInfo.textContent = displayMessage;
                }
            }
        });
    </script>
</body>

</html>